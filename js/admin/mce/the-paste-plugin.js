!function e(t,o,n){function r(s,a){if(!o[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=o[s]={exports:{}};t[s][0].call(d.exports,(function(e){return r(t[s][1][e]||e)}),d,d.exports,e,t,o,n)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(e,t,o){(function(t){(function(){"use strict";i("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null);var o=i(e("converter")),n=i(e("notices")),r=i(e("uploader"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t,o){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,o)}function a(e,t,o){return e.set(c(e,t),o),o}function l(e,t){return e.get(c(e,t))}function c(e,t,o){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:o;throw new TypeError("Private element is not present on this object")}var d=new WeakMap,u=new WeakMap;class p{static init(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return f._=new p(e,t),p.get()}static get(){return f._}static destroy(){f._=null}static setEnabled(e){h._=e}get isAsync(){return l(u,this)}get hasPastedFiles(){return this.files.length>0}get pastedContent(){return this.isAsync?'<p id="the-pasted-async"></p>':this.files.map(((e,t)=>{const o=URL.createObjectURL(e);return'<p><img id="the-pasted-'.concat(e.type,"-").concat(t,'" src="').concat(o,'" alt="').concat(e.name,'" /></p>')})).join("")}get files(){return l(d,this)}constructor(e,t){var n;(s(this,d,[]),s(this,u,!1),this.clipboardData=e.clipboardData,this.body=e.target.closest("body"),h._)&&(a(d,this,Array.from(null!==(n=this.clipboardData.files)&&void 0!==n?n:[])),this.files.length&&t||a(u,this,Array.from(this.clipboardData.items).filter((e=>"string"===e.kind&&"text/html"===e.type)).length>0));(this.isAsync||this.files.length)&&(this.isAsync?(async()=>{let t,n;const r=new URL(document.location),i=await o.default.clipboardItemsToHtml(e.clipboardData.items),s=document.createElement("div"),a=this.body.querySelector("#the-pasted-async"),l=[];s.innerHTML=i,l.push(...Array.from(s.querySelectorAll("img")));const c=Array.from(s.childNodes).filter((e=>[Node.ELEMENT_NODE,Node.TEXT_NODE].includes(e.nodeType)));for(t=0;t<c.length;t++)null==a||a.before(c[t]);if(null==a||a.remove(),l.length){for(t=0;t<l.length;t++)n=new URL(l[t].src),["http:","https:"].includes(n.protocol)&&r.hostname===n.hostname||(l[t].src=await o.default.urlToBlobUrl(l[t].src));this.body.dispatchEvent(new Event("FilesPasted"))}})():this.body.querySelector('[src^="data:"]:not(.--paste-process)')&&this.body.dispatchEvent(new Event("FilesPasted")))}dumpClipboardData(){const e="[the paste]";return Array.from(this.clipboardData.files).forEach((t=>console.log(e,t))),Array.from(this.clipboardData.items).forEach((t=>{console.log(e,t,t.kind,t.type),"string"===t.kind?t.getAsString((e=>console.log(e))):console.log(e,t.getAsFile())})),this}}var f={_:null},h={_:!0};tinymce.PluginManager.add("the_paste",(function(e){let t,o;e.addButton("thepaste_onoff",{icon:"thepaste_onoff",tooltip:thepaste.l10n.paste_files,onPostRender:function(){t=this},onClick:function(){this.active(!this.active()),fetch("".concat(thepaste.options.editor.enable_ajax_url,"&enabled=").concat(this.active()?1:0))},active:thepaste.options.editor.enabled}),e.once("preinit",(function(){e.wp&&e.wp._createToolbar&&(o=e.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wp_img_thepaste_upload","wp_img_edit","wp_img_remove"]))})),e.addButton("wp_img_thepaste_upload",{icon:"dashicon dashicons dashicons-upload thepaste-upload",tooltip:thepaste.l10n.upload_image,onclick:function(){r.default.inlineUpload(e.selection.getNode())}}),e.on("wptoolbar",(function(t){var n;"IMG"!==t.element.nodeName||e.wp.isPlaceholder(t.element)||(t.toolbar=o,n=o.$el.find(".thepaste-upload").closest(".mce-btn"),!function(e){const t=e.src.substring(0,5);return"blob:"===t||"data:"===t}(t.element)?n.hide():n.show())}));const i=()=>Array.from(e.dom.doc.body.querySelectorAll('[src^="blob:"]:not(.--paste-process),[src^="data:"]:not(.--paste-process)'));e.on("PastePlainTextToggle",(e=>{let{state:o}=e;p.setEnabled(!o),t.disabled(o)})).on("init",(()=>{e.dom.doc.body.addEventListener("FilesPasted",(async e=>{let t,o;const s=i();for(t=0;t<s.length;t++)o=s[t],o.classList.add("--paste-process"),r.default.inlineUpload(o).catch((e=>n.default.error(e.message,!0)||o.remove()))}))})).on("Paste",(o=>{if(document.body.matches(".modal-open"))return;const n=!t||t.active(),r=p.init(o,n);if(thepaste.options.editor.debugMode&&r.dumpClipboardData(),!r.isAsync&&!r.files.length)return void p.destroy();const s=e=>{let t;(t=r.pastedContent)&&(e.content=t),p.destroy()},a=t=>{setTimeout((()=>e.dom.doc.body.dispatchEvent(new Event("FilesPasted")))),e.off("PastePreProcess",s),e.off("PastePostProcess",a)};e.once("input",(async t=>{const o=i();let n,l;if(o.length){for(n=0;n<o.length;n++)l=o[n],r.files[n]&&(l.alt=r.files[n].name,l.src=URL.createObjectURL(r.files[n]));setTimeout((()=>e.dom.doc.body.dispatchEvent(new Event("FilesPasted")))),o.length===r.files.length&&(e.off("PastePreProcess",s),e.off("PastePostProcess",a))}})).on("PastePreProcess",s).on("PastePostProcess",a)}))}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{converter:3,notices:6,uploader:7}],2:[function(e,t,o){"use strict";const n=new class{get svg(){return _wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").includes("svg")}get webp(){return 0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}};t.exports={rml:{file:e=>(e.getSource||(e.getSource=()=>e),e)},supports:n}},{}],3:[function(e,t,o){"use strict";var n=e("compat"),r=e("filename");const i={clipboardItemsToFiles:e=>{const t=[];return new Promise(((o,r)=>{const s=Array.from(e).map((e=>{if("string"===e.kind){const s=(o=e.type,null!==(r={"text/plain":async e=>{if(n.supports.svg){const t=await i.itemToString(e);if(t.toLowerCase().indexOf("<svg")>=0&&(new DOMParser).parseFromString(t,"image/svg+xml").querySelector("svg"))return[i.stringToFile(t,"image/svg+xml")]}return[]},"text/html":async e=>{const t=new URL(document.location),o=document.createElement("div");o.innerHTML=await i.itemToString(e);const n=Array.from(o.querySelectorAll("img")).filter((e=>{const o=new URL(e.src);return!["http:","https:"].includes(o.protocol)||t.hostname!==o.hostname})).map((e=>i.elementToFile(e)));return new Promise(((e,t)=>{Promise.allSettled(n).then((t=>e(Array.from(t).map((e=>e.value)))))}))}}[o])&&void 0!==r?r:()=>new Promise(((e,t)=>e([]))));return s(e).then((e=>{t.push(...e.filter((e=>e.size>0)))})).catch((e=>console.error(e)))}var o,r}));Promise.allSettled(s).then((()=>o(t)))}))},clipboardItemsToHtml:async e=>{let t,o;for(t=0;t<e.length;t++)if(o=e[t],"string"===o.kind&&"text/html"===o.type)return await i.itemToString(o);return""},gdocsItemToSources:async e=>new Promise(((t,o)=>{e.getAsString((async e=>{const o=Object.values(JSON.parse(JSON.parse(e).data).image_urls);t(o)}))})),gdocsItemToFiles:async e=>{let t;const o=await i.gdocsItemToSources(e),n=[];for(t=0;t<o.length;t++)n.push(await i.blobUrlToFile(o[t]));return n},itemToString:async e=>new Promise(((t,o)=>{e.getAsString((e=>t(e)))})),elementToFile:async e=>await i.urlToFile(e.src,e.alt),urlToFile:async function(e){let t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=e.substr(0,e.indexOf(":"));return"data"===n?t=i.dataUrlToFile(e,o):["blob","http","https"].includes(n)&&(t=await i.blobUrlToFile(e,o)),t},urlToMime:async e=>{const t=e.substr(0,e.indexOf(":"));let o;return"data"===t?o=i.dataUrlToMime(e):["blob","http","https"].includes(t)&&(o=await i.blobUrlToMime(e)),o},urlToType:async e=>{const t=await i.urlToMime(e);return t.substr(0,t.indexOf("/"))},urlToBlobUrl:async e=>{const t=await i.blobUrlToFile(e);return i.fileToBlobUrl(t)},stringToFile:(e,t)=>i.blobToFile(new Blob([e],{type:t})),blobToFile:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new File([e],(0,r.safeFilename)(e,t),{type:e.type})},blobUrlToMime:async e=>(await i.blobUrlToBlob(e)).type,blobUrlToType:async e=>{const t=await i.blobUrlToBlob(e);return t.type.substr(0,t.type.indexOf("/"))},blobUrlToBlob:async function(e){return await fetch(e).then((e=>e.blob()))},blobUrlToFile:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const o=await i.blobUrlToBlob(e);return i.blobToFile(o,t)},blobUrlToDataUrl:async e=>{const t=await fetch(e).then((e=>e.blob()));return await i.fileToDataUrl(t)},dataUrlToMime:e=>e.match("data:([^;]+);")[1],dataUrlToType:e=>e.match("data:([^/]+)/")[1],dataUrlToBlob:e=>{let t=e.split(","),o=t[0].match(/:(.*?);/)[1],n=atob(t[1]),r=n.length,i=new Uint8Array(r);for(;r--;)i[r]=n.charCodeAt(r);return new Blob([i],{type:o})},dataUrlToFile:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return i.blobToFile(i.dataUrlToBlob(e),t)},dataUrlToBlobUrl:e=>i.fileToBlobUrl(i.dataUrlToBlob(e)),fileToBlobUrl:e=>URL.createObjectURL(e),fileToDataUrl:e=>new Promise(((t,o)=>{const n=new FileReader;n.addEventListener("load",(()=>t(n.result))),n.readAsDataURL(e)}))};t.exports=i},{compat:2,filename:4}],4:[function(e,t,o){"use strict";var n,r=(n=e("mime"))&&n.__esModule?n:{default:n};const i=e=>{var t,o,n;const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return("00"+e.toString()).substr(-t)};let i=thepaste.options.default_filename;const s=new Date,a=(null===(t=document.querySelector('#post [name="post_title"]#title'))||void 0===t?void 0:t.value)||(null===(o=document.querySelector(".wp-block-post-title"))||void 0===o?void 0:o.textContent)||(null===(n=document.querySelector("h1"))||void 0===n?void 0:n.textContent),l=thepaste.options.filename_values,c=[{s:"%Y",r:s.getFullYear()},{s:"%y",r:s.getFullYear()%100},{s:"%m",r:r(s.getMonth()+1)},{s:"%d",r:r(s.getDate())},{s:"%e",r:s.getDate()},{s:"%H",r:r(s.getHours())},{s:"%I",r:r(s.getHours()%12)},{s:"%M",r:r(s.getMinutes())},{s:"%S",r:r(s.getSeconds())},{s:"%s",r:Math.floor(s.getTime()/1e3)},{s:"%x",r:s.toLocaleDateString()},{s:"%X",r:s.toLocaleTimeString()}];return void 0!==a?c.push({s:"<postname>",r:a}):c.push({s:"<postname>",r:""}),Object.keys(l).forEach((e=>{l[e]?c.push({s:"<".concat(e,">"),r:l[e]}):c.push({s:"<".concat(e,">"),r:""})})),c.forEach((function(e){i=i.replace(e.s,e.r)})),"string"==typeof e&&(i+="."+e),i};t.exports={generateFilename:i,safeFilename:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=e.type;const n=r.default.extension(o);return t=t.replace(/[^\p{L}\p{M}\p{S}\p{N}\p{P}\p{Zs}]/gu,"-").trim(),t||(t=i(n)),n!==t.split(".").pop()&&(t+=".".concat(n)),t}}},{mime:5}],5:[function(e,t,o){"use strict";const n=Object.keys(thepaste.options.mime_types),r=Object.values(thepaste.options.mime_types);n.push("zip"),r.push("application/x-zip-compressed"),t.exports={extension:e=>{const t=r.indexOf(e);return-1!==t&&n[t]},type:e=>{const t=n.indexOf(e);return-1!==t&&r[t]}}},{}],6:[function(e,t,o){(function(e){(function(){"use strict";var o,n=(o="undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null)&&o.__esModule?o:{default:o};class r{static success(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i.call(r,"updated",e,t)}static notify(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i.call(r,"",e,t)}static warn(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i.call(r,"notice-warning",e,t)}static error(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i.call(r,"error",e,t)}}function i(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r="".concat(e," notice ").concat(o?"is-dismissible":"").trim(),i='<div class="'.concat(r,'"><p>').concat(t,"</p></div>"),s=(0,n.default)(".wp-header-end").first();(0,n.default)(i).insertAfter(s),(0,n.default)(document).trigger("wp-updates-notice-added")}'<button type="button" class="notice-dismiss"><span class="screen-reader-text">'.concat(wp.i18n.__("Dismiss this notice."),"</span></button>");t.exports=r}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,t,o){"use strict";var n,r=l(e("mime")),i=l(e("converter")),s=l(e("notices")),a=e("compat");function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,o){d(e,t),t.set(e,o)}function d(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function u(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function p(e,t){return e.get(f(e,t))}function f(e,t,o){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:o;throw new TypeError("Private element is not present on this object")}const h=_wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(","),m=Math.min(209715200,parseInt(_wpPluploadSettings.defaults.filters.max_file_size));var g=new WeakMap,b=new WeakMap,w=new WeakMap,y=new WeakMap,v=new WeakSet;class T{static get ready(){return!!T.workflow.uploader.uploader&&!!T.workflow.uploader.uploader.ready}static get workflow(){return S._||(S._=wp.media.editor.open(window.wpActiveEditor,{frame:"post",state:"insert",title:thepaste.l10n.copy_paste,multiple:!1})),S._}static get uploader(){return T.workflow.uploader.uploader.uploader}static get(e){return new T(e)}constructor(e){var t,o,n=this;d(t=this,o=v),o.add(t),u(this,"onUploaded",(()=>{})),u(this,"onProgress",(()=>{})),u(this,"onError",(()=>{})),c(this,g,void 0),c(this,b,((e,t)=>{f(v,this,_).call(this,t)&&this.onProgress(t.percent)})),c(this,w,((e,t,o)=>{f(v,this,_).call(this,t)&&(this.onUploaded(t),f(v,this,E).call(this))})),c(this,y,(function(e,t){f(v,n,_).call(n,t)&&n.onError(t)})),e.name||(e.name=F.getFilename(r.default.extension(e.type))),function(e,t,o){e.set(f(e,t),o)}(g,this,a.rml.file(e))}destructor(){T.workflow.close()}upload(){T.ready?f(v,this,U).call(this):T.workflow.once("uploader:ready",(()=>{f(v,this,U).call(this)}))}dump(){console.log(arguments)}}function _(e){return p(g,this).name===e.name&&p(g,this).size===e.size}function U(){f(v,this,P).call(this),n.uploader.addFile(p(g,this)),n.workflow.close()}function P(){n.uploader.bind("UploadProgress",p(b,this),this),n.uploader.bind("FileUploaded",p(w,this),this),n.uploader.bind("Error",p(y,this),this)}function E(){n.uploader.unbind("UploadProgress",p(b,this),this),n.uploader.unbind("FileUploaded",p(w,this),this),n.uploader.unbind("Error",p(y,this),this)}n=T;var S={_:void 0};const F={inlineUpload:async e=>{var t;const o=await i.default.elementToFile(e),n=T.get(o),a=document.createElement("progress");if(a.classList.add("the-paste-progress"),!(e=>!!e&&e.size<=m)(o))throw new ErrorEvent("the-paste-upload",{message:"File size exceeds ".concat(m," byte")});if(!(e=>!!e&&h.includes(r.default.extension(e.type)))(o))throw new ErrorEvent("the-paste-upload",{message:"Type ".concat(o.type," not allowed")});a.max=100,null===(t=e.parentNode)||void 0===t||t.insertBefore(a,e),e.remove(),n.onProgress=e=>{a.value=e},n.onError=e=>{console.error(e),s.default.error("<strong>".concat(thepaste.l10n.the_paste,":</strong> ").concat(e.message," File: <em>").concat(o.name,"</em>"),!0),a.remove()},n.onUploaded=e=>{const t=document.createElement("p"),o=e.attachment.attributes,n=getUserSetting("urlbutton","none");"image"===o.type?t.innerHTML=wp.media.string.image({link:n,align:getUserSetting("align","none"),size:getUserSetting("imgsize","medium")},o):"video"===o.type?t.innerHTML=wp.media.string.video({link:"none"!==n?n:"embed"},o):"audio"===o.type?t.innerHTML=wp.media.string.audio({link:"none"!==n?n:"embed"},o):t.innerHTML=wp.media.string.link({link:"none"!==n?n:"file"},o),a.replaceWith(t.childNodes[0])},n.upload()},getFilename:e=>{const t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return("00"+e.toString()).substr(-t)};let o=thepaste.options.default_filename;const n=new Date,r=document.querySelector('#post [name="post_title"]#title').value,i=(document.querySelector(".display-name").textContent,[{s:"%Y",r:n.getFullYear()},{s:"%y",r:n.getFullYear()%100},{s:"%m",r:t(n.getMonth()+1)},{s:"%d",r:t(n.getDate())},{s:"%e",r:n.getDate()},{s:"%H",r:t(n.getHours())},{s:"%I",r:t(n.getHours()%12)},{s:"%M",r:t(n.getMinutes())},{s:"%S",r:t(n.getSeconds())},{s:"%s",r:Math.floor(n.getTime()/1e3)}]);return void 0!==r?i.push({s:"<postname>",r:r}):i.push({s:"<postname>",r:""}),i.forEach((function(e){o=o.replace(e.s,e.r)})),"string"==typeof e&&(o+="."+e),o}};t.exports=F},{compat:2,converter:3,mime:5,notices:6}]},{},[1]);
//# sourceMappingURL=the-paste-plugin.js.map
