!function o(r,i,a){function s(t,e){if(!i[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}n=i[t]={exports:{}},r[t][0].call(n.exports,function(e){return s(r[t][1][e]||e)},n,n.exports,o,r,i,a)}return i[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(y,e,t){!function(v){!function(){"use strict";e("undefined"!=typeof window?window.jQuery:void 0!==v?v.jQuery:null);var c=e(y("converter")),r=e(y("notices")),i=e(y("uploader"));function e(e){return e&&e.__esModule?e:{default:e}}function n(e,t,n){var o=e;if(t.has(o))throw new TypeError("Cannot initialize the same private elements twice on an object");t.set(e,n)}function o(e,t,n){f(e,a(e,t,"set"),n)}function t(e,t){return l(e,a(e,t,"get"))}function a(e,t,n){if(t.has(e))return t.get(e);throw new TypeError("attempted to "+n+" private field on non-instance")}function s(e,t,n){return p(e,t),d(n,"get"),l(e,n)}function l(e,t){return t.get?t.get.call(e):t.value}function u(e,t,n,o){p(e,t),d(n,"set"),f(e,n,o)}function d(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function p(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function f(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}var h=new WeakMap,m=new WeakMap;class g{static init(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return u(g,g,w,new g(e,t)),g.get()}static get(){return s(g,g,w)}static destroy(){u(g,g,w,null)}static setEnabled(e){u(g,g,b,e)}get isAsync(){return t(this,m)}get hasPastedFiles(){return 0<this.files.length}get pastedContent(){return this.isAsync?'<p id="the-pasted-async"></p>':this.files.map((e,t)=>{var n=URL.createObjectURL(e);return'<p><img id="the-pasted-'.concat(e.type,"-").concat(t,'" src="').concat(n,'" alt="').concat(e.name,'" /></p>')}).join("")}get files(){return t(this,h)}constructor(l,e){var t;n(this,h,{writable:!0,value:[]}),n(this,m,{writable:!0,value:!1}),this.clipboardData=l.clipboardData,this.body=l.target.closest("body"),s(g,g,b)&&(o(this,h,Array.from(null!=(t=this.clipboardData.files)?t:[])),this.files.length&&e||o(this,m,0<Array.from(this.clipboardData.items).filter(e=>"string"===e.kind&&"text/html"===e.type).length)),(this.isAsync||this.files.length)&&(this.isAsync?(async()=>{let e,t;var n=new URL(document.location),o=await c.default.clipboardItemsToHtml(l.clipboardData.items),r=document.createElement("div"),i=this.body.querySelector("#the-pasted-async"),a=[],s=(r.innerHTML=o,a.push(...Array.from(r.querySelectorAll("img"))),Array.from(r.childNodes).filter(e=>[Node.ELEMENT_NODE,Node.TEXT_NODE].includes(e.nodeType)));for(e=0;e<s.length;e++)null!=i&&i.before(s[e]);if(null!=i&&i.remove(),a.length){for(e=0;e<a.length;e++)t=new URL(a[e].src),["http:","https:"].includes(t.protocol)&&n.hostname===t.hostname||(a[e].src=await c.default.urlToBlobUrl(a[e].src));this.body.dispatchEvent(new Event("FilesPasted"))}})():this.body.querySelector('[src^="data:"]:not(.--paste-process)')&&this.body.dispatchEvent(new Event("FilesPasted")))}dumpClipboardData(){const t="[the paste]";return Array.from(this.clipboardData.files).forEach(e=>console.log(t,e)),Array.from(this.clipboardData.items).forEach(e=>{console.log(t,e,e.kind,e.type),"string"===e.kind?e.getAsString(e=>console.log(e)):console.log(t,e.getAsFile())}),this}}var w={writable:!0,value:null},b={writable:!0,value:!0};tinymce.PluginManager.add("the_paste",function(s){let n,o;s.addButton("thepaste_onoff",{icon:"thepaste_onoff",tooltip:thepaste.l10n.paste_files,onPostRender:function(){n=this},onClick:function(){this.active(!this.active()),fetch("".concat(thepaste.options.editor.enable_ajax_url,"&enabled=").concat(this.active()?1:0))},active:thepaste.options.editor.enabled}),s.once("preinit",function(){s.wp&&s.wp._createToolbar&&(o=s.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wp_img_thepaste_upload","wp_img_edit","wp_img_remove"]))}),s.addButton("wp_img_thepaste_upload",{icon:"dashicon dashicons dashicons-upload thepaste-upload",tooltip:thepaste.l10n.upload_image,onclick:function(){i.default.inlineUpload(s.selection.getNode())}}),s.on("wptoolbar",function(e){var t;"IMG"!==e.element.nodeName||s.wp.isPlaceholder(e.element)||(t=(e.toolbar=o).$el.find(".thepaste-upload").closest(".mce-btn"),!function(e){e=e.src.substring(0,5);return"blob:"===e||"data:"===e}(e.element)?t.hide():t.show())});const l=()=>Array.from(s.dom.doc.body.querySelectorAll('[src^="blob:"]:not(.--paste-process),[src^="data:"]:not(.--paste-process)'));s.on("PastePlainTextToggle",e=>{e=e.state;g.setEnabled(!e),n.disabled(e)}).on("init",()=>{s.dom.doc.body.addEventListener("FilesPasted",async e=>{let t,n;var o=l();for(t=0;t<o.length;t++)(n=o[t]).classList.add("--paste-process"),i.default.inlineUpload(n).catch(e=>r.default.error(e.message,!0)||n.remove())})}).on("Paste",e=>{if(!document.body.matches(".modal-open")){var t=!n||n.active();const r=g.init(e,t);if(thepaste.options.editor.debugMode&&r.dumpClipboardData(),r.isAsync||r.files.length){const i=e=>{var t;(t=r.pastedContent)&&(e.content=t),g.destroy()},a=e=>{setTimeout(()=>s.dom.doc.body.dispatchEvent(new Event("FilesPasted"))),s.off("PastePreProcess",i),s.off("PastePostProcess",a)};s.once("input",async e=>{var t=l();let n,o;if(t.length){for(n=0;n<t.length;n++)o=t[n],r.files[n]&&(o.alt=r.files[n].name,o.src=URL.createObjectURL(r.files[n]));setTimeout(()=>s.dom.doc.body.dispatchEvent(new Event("FilesPasted"))),t.length===r.files.length&&(s.off("PastePreProcess",i),s.off("PastePostProcess",a))}}).on("PastePreProcess",i).on("PastePostProcess",a)}else g.destroy()}})})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{converter:3,notices:6,uploader:7}],2:[function(e,t,n){"use strict";var o=new class{get svg(){return _wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").includes("svg")}get webp(){return 0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}};t.exports={rml:{file:e=>(e.getSource||(e.getSource=()=>e),e)},supports:o}},{}],3:[function(e,t,n){"use strict";var i=e("compat"),o=e("filename");const a={clipboardItemsToFiles:o=>{const r=[];return new Promise((e,t)=>{var n=Array.from(o).map(e=>{var t;if("string"===e.kind)return(null!=(t={"text/plain":async e=>{if(i.supports.svg){e=await a.itemToString(e);if(0<=e.toLowerCase().indexOf("<svg"))if((new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg"))return[a.stringToFile(e,"image/svg+xml")]}return[]},"text/html":async e=>{const t=new URL(document.location);var n=document.createElement("div");n.innerHTML=await a.itemToString(e);const o=Array.from(n.querySelectorAll("img")).filter(e=>{e=new URL(e.src);return!["http:","https:"].includes(e.protocol)||t.hostname!==e.hostname}).map(e=>a.elementToFile(e));return new Promise((t,e)=>{Promise.allSettled(o).then(e=>t(Array.from(e).map(e=>e.value)))})}}[t=e.type])?t:()=>new Promise((e,t)=>e([])))(e).then(e=>{r.push(...e.filter(e=>0<e.size))}).catch(e=>console.error(e))});Promise.allSettled(n).then(()=>e(r))})},clipboardItemsToHtml:async e=>{let t,n;for(t=0;t<e.length;t++)if("string"===(n=e[t]).kind&&"text/html"===n.type)return a.itemToString(n);return""},gdocsItemToSources:async n=>new Promise((t,e)=>{n.getAsString(async e=>{e=Object.values(JSON.parse(JSON.parse(e).data).image_urls);t(e)})}),gdocsItemToFiles:async e=>{let t;var n=await a.gdocsItemToSources(e),o=[];for(t=0;t<n.length;t++)o.push(await a.blobUrlToFile(n[t]));return o},itemToString:async n=>new Promise((t,e)=>{n.getAsString(e=>t(e))}),elementToFile:async e=>{return await a.urlToFile(e.src,e.alt)},urlToFile:async function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";let n;var o=e.substr(0,e.indexOf(":"));return"data"===o?n=a.dataUrlToFile(e,t):["blob","http","https"].includes(o)&&(n=await a.blobUrlToFile(e,t)),n},urlToMime:async e=>{var t=e.substr(0,e.indexOf(":"));let n;return"data"===t?n=a.dataUrlToMime(e):["blob","http","https"].includes(t)&&(n=await a.blobUrlToMime(e)),n},urlToType:async e=>{e=await a.urlToMime(e);return e.substr(0,e.indexOf("/"))},urlToBlobUrl:async e=>{e=await a.blobUrlToFile(e);return a.fileToBlobUrl(e)},stringToFile:(e,t)=>a.blobToFile(new Blob([e],{type:t})),blobToFile:function(e){return new File([e],(0,o.safeFilename)(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:""),{type:e.type})},blobUrlToMime:async e=>{return(await a.blobUrlToBlob(e)).type},blobUrlToType:async e=>{e=await a.blobUrlToBlob(e);return e.type.substr(0,e.type.indexOf("/"))},blobUrlToBlob:async function(e){return await fetch(e).then(e=>e.blob())},blobUrlToFile:async function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",e=await a.blobUrlToBlob(e);return a.blobToFile(e,t)},blobUrlToDataUrl:async e=>{e=await fetch(e).then(e=>e.blob());return await a.fileToDataUrl(e)},dataUrlToMime:e=>e.match("data:([^;]+);")[1],dataUrlToType:e=>e.match("data:([^/]+)/")[1],dataUrlToBlob:e=>{let t=e.split(","),n=t[0].match(/:(.*?);/)[1],o=atob(t[1]),r=o.length,i=new Uint8Array(r);for(;r--;)i[r]=o.charCodeAt(r);return new Blob([i],{type:n})},dataUrlToFile:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return a.blobToFile(a.dataUrlToBlob(e),t)},dataUrlToBlobUrl:e=>a.fileToBlobUrl(a.dataUrlToBlob(e)),fileToBlobUrl:e=>URL.createObjectURL(e),fileToDataUrl:o=>new Promise((e,t)=>{const n=new FileReader;n.addEventListener("load",()=>e(n.result)),n.readAsDataURL(o)})};t.exports=a},{compat:2,filename:4}],4:[function(e,t,n){"use strict";var o=(e=e("mime"))&&e.__esModule?e:{default:e};const r=e=>{function t(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2;return("00"+e.toString()).substr(-t)}var n;let o=thepaste.options.default_filename;const r=new Date,i=(null==(n=document.querySelector('#post [name="post_title"]#title'))?void 0:n.value)||(null==(n=document.querySelector(".wp-block-post-title"))?void 0:n.textContent)||(null==(n=document.querySelector("h1"))?void 0:n.textContent),a=thepaste.options.filename_values,s=[{s:"%Y",r:r.getFullYear()},{s:"%y",r:r.getFullYear()%100},{s:"%m",r:t(r.getMonth()+1)},{s:"%d",r:t(r.getDate())},{s:"%e",r:r.getDate()},{s:"%H",r:t(r.getHours())},{s:"%I",r:t(r.getHours()%12)},{s:"%M",r:t(r.getMinutes())},{s:"%S",r:t(r.getSeconds())},{s:"%s",r:Math.floor(r.getTime()/1e3)},{s:"%x",r:r.toLocaleDateString()},{s:"%X",r:r.toLocaleTimeString()}];return void 0!==i?s.push({s:"<postname>",r:i}):s.push({s:"<postname>",r:""}),Object.keys(a).forEach(e=>{a[e]?s.push({s:"<".concat(e,">"),r:a[e]}):s.push({s:"<".concat(e,">"),r:""})}),s.forEach(function(e){o=o.replace(e.s,e.r)}),"string"==typeof e&&(o+="."+e),o};t.exports={generateFilename:r,safeFilename:function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";e=e.type,e=o.default.extension(e);return e!==(t=(t=t.replace(/[^\p{L}\p{M}\p{S}\p{N}\p{P}\p{Zs}]/gu,"-").trim())||r(e)).split(".").pop()&&(t+=".".concat(e)),t}}},{mime:5}],5:[function(e,t,n){"use strict";const o=Object.keys(thepaste.options.mime_types),r=Object.values(thepaste.options.mime_types);o.push("zip"),r.push("application/x-zip-compressed"),t.exports={extension:e=>{e=r.indexOf(e);return-1!==e&&o[e]},type:e=>{e=o.indexOf(e);return-1!==e&&r[e]}}},{}],6:[function(e,a,t){!function(t){!function(){"use strict";var e,o=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e};function n(e,t,n){if(e!==t)throw new TypeError("Private static access of wrong provenance");return n}function r(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],e="".concat(e," notice ").concat(n?"is-dismissible":"").trim(),n='<div class="'.concat(e,'"><p>').concat(t,"</p></div>"),e=(0,o.default)(".wp-header-end").first();(0,o.default)(n).insertAfter(e),(0,o.default)(document).trigger("wp-updates-notice-added")}'<button type="button" class="notice-dismiss"><span class="screen-reader-text">'.concat(wp.i18n.__("Dismiss this notice."),"</span></button>");a.exports=class i{static success(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];n(i,i,r).call(i,"updated",e,t)}static notify(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];n(i,i,r).call(i,"",e,t)}static warn(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];n(i,i,r).call(i,"notice-warning",e,t)}static error(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];n(i,i,r).call(i,"error",e,t)}}}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,t,B){"use strict";var i=n(e("mime")),a=n(e("converter")),s=n(e("notices")),r=e("compat");function n(e){return e&&e.__esModule?e:{default:e}}function l(e,t){o(e,t),t.add(e)}function c(e,t,n){o(e,t),t.set(e,n)}function o(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function u(e,t,n){(t=function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}function d(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}function p(e,t,n){return h(e,t),f(n,"get"),w(e,n)}function f(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function h(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function m(e,t){return w(e,g(e,t,"get"))}function g(e,t,n){if(t.has(e))return t.get(e);throw new TypeError("attempted to "+n+" private field on non-instance")}function w(e,t){return t.get?t.get.call(e):t.value}function b(e,t,n){if(t.has(e))return n;throw new TypeError("attempted to get private field on non-instance")}const v=_wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(","),y=Math.min(209715200,parseInt(_wpPluploadSettings.defaults.filters.max_file_size));var T=new WeakMap,U=new WeakMap,_=new WeakMap,P=new WeakMap,E=new WeakSet,S=new WeakSet,F=new WeakSet,x=new WeakSet;class M{static get ready(){return!!M.workflow.uploader.uploader&&!!M.workflow.uploader.uploader.ready}static get workflow(){var e,t,n,o;return p(M,M,O)||(e=M,t=M,n=O,o=wp.media.editor.open(window.wpActiveEditor,{frame:"post",state:"insert",title:thepaste.l10n.copy_paste,multiple:!1}),h(e,t),f(n,"set"),d(e,n,o)),p(M,M,O)}static get uploader(){return M.workflow.uploader.uploader.uploader}static get(e){return new M(e)}constructor(e){var t,n,o=this;l(this,x),l(this,F),l(this,S),l(this,E),u(this,"onUploaded",()=>{}),u(this,"onProgress",()=>{}),u(this,"onError",()=>{}),c(this,T,{writable:!0,value:void 0}),c(this,U,{writable:!0,value:(e,t)=>{b(this,E,k).call(this,t)&&this.onProgress(t.percent)}}),c(this,_,{writable:!0,value:(e,t,n)=>{b(this,E,k).call(this,t)&&(this.onUploaded(t),b(this,x,D).call(this))}}),c(this,P,{writable:!0,value:function(e,t){b(o,E,k).call(o,t)&&o.onError(t)}}),e.name||(e.name=j.getFilename(i.default.extension(e.type))),t=this,n=T,e=r.rml.file(e),d(t,g(t,n,"set"),e)}destructor(){M.workflow.close()}upload(){M.ready?b(this,S,L).call(this):M.workflow.once("uploader:ready",()=>{b(this,S,L).call(this)})}dump(){console.log(arguments)}}function k(e){return m(this,T).name===e.name&&m(this,T).size===e.size}function L(){b(this,F,A).call(this),M.uploader.addFile(m(this,T)),M.workflow.close()}function A(){M.uploader.bind("UploadProgress",m(this,U),this),M.uploader.bind("FileUploaded",m(this,_),this),M.uploader.bind("Error",m(this,P),this)}function D(){M.uploader.unbind("UploadProgress",m(this,U),this),M.uploader.unbind("FileUploaded",m(this,_),this),M.uploader.unbind("Error",m(this,P),this)}var O={writable:!0,value:void 0};const j={inlineUpload:async e=>{const t=await a.default.elementToFile(e);var n,o=M.get(t);const r=document.createElement("progress");if(r.classList.add("the-paste-progress"),!(n=t)||!(n.size<=y))throw new ErrorEvent("the-paste-upload",{message:"File size exceeds ".concat(y," byte")});if(!(n=t)||!v.includes(i.default.extension(n.type)))throw new ErrorEvent("the-paste-upload",{message:"Type ".concat(t.type," not allowed")});r.max=100,null!=(n=e.parentNode)&&n.insertBefore(r,e),e.remove(),o.onProgress=e=>{r.value=e},o.onError=e=>{console.error(e),s.default.error("<strong>".concat(thepaste.l10n.the_paste,":</strong> ").concat(e.message," File: <em>").concat(t.name,"</em>"),!0),r.remove()},o.onUploaded=e=>{var t=document.createElement("p"),e=e.attachment.attributes,n=getUserSetting("urlbutton","none");"image"===e.type?t.innerHTML=wp.media.string.image({link:n,align:getUserSetting("align","none"),size:getUserSetting("imgsize","medium")},e):"video"===e.type?t.innerHTML=wp.media.string.video({link:"none"!==n?n:"embed"},e):"audio"===e.type?t.innerHTML=wp.media.string.audio({link:"none"!==n?n:"embed"},e):t.innerHTML=wp.media.string.link({link:"none"!==n?n:"file"},e),r.replaceWith(t.childNodes[0])},o.upload()},getFilename:e=>{function t(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2;return("00"+e.toString()).substr(-t)}let n=thepaste.options.default_filename;var o=new Date,r=document.querySelector('#post [name="post_title"]#title').value,o=(document.querySelector(".display-name").textContent,[{s:"%Y",r:o.getFullYear()},{s:"%y",r:o.getFullYear()%100},{s:"%m",r:t(o.getMonth()+1)},{s:"%d",r:t(o.getDate())},{s:"%e",r:o.getDate()},{s:"%H",r:t(o.getHours())},{s:"%I",r:t(o.getHours()%12)},{s:"%M",r:t(o.getMinutes())},{s:"%S",r:t(o.getSeconds())},{s:"%s",r:Math.floor(o.getTime()/1e3)}]);return o.push(void 0!==r?{s:"<postname>",r:r}:{s:"<postname>",r:""}),o.forEach(function(e){n=n.replace(e.s,e.r)}),"string"==typeof e&&(n+="."+e),n}};t.exports=j},{compat:2,converter:3,mime:5,notices:6}]},{},[1]);
//# sourceMappingURL=the-paste-plugin.js.map
