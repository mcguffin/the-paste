!function a(n,o,s){function r(t,e){if(!o[t]){if(!n[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=o[t]={exports:{}},n[t][0].call(i.exports,function(e){return r(n[t][1][e]||e)},i,i.exports,a,n,o,s)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)r(s[e]);return r}({1:[function(e,t,i){"use strict";var a=s(e("converter")),n=s(e("image-dialog")),o=e("compat");function s(e){return e&&e.__esModule?e:{default:e}}const r=wp.media.View.extend({template:wp.template("the-paste-instructions"),className:"the-paste-instructions",render:function(){wp.media.View.prototype.render.apply(this,arguments),setInterval(()=>{this.$el.prop("hidden",!document.hasFocus())},100)}});_.extend(wp.media.view.MediaFrame.prototype,{_parentInitialize:wp.media.view.MediaFrame.prototype.initialize,initialize:function(e){this._parentInitialize.apply(this,arguments),this.on("attach",this.addPasteInstructions,this),this.pasteInstructions=new r,this.pasteInstructions.render()},addPasteInstructions:function(){this.$el.find("#media-frame-title").append(this.pasteInstructions.el)}}),_.extend(wp.media.view.AttachmentsBrowser.prototype,{_parentInitialize:wp.media.view.AttachmentsBrowser.prototype.initialize,initialize:function(){this._parentInitialize.apply(this,arguments);var e=new r({priority:-10});e.render(),this.toolbar.set("pasteInstructions",e),document.addEventListener("paste",async e=>{var t;if(this.$el.is(":visible"))return(t=Array.from(e.clipboardData.files)).length&&(e.preventDefault(),e.stopPropagation()),t.push(...await a.default.clipboardItemsToFiles(e.clipboardData.items)),t.length?this.handlePastedFiles(t):void 0},{capture:!0})},handlePastedFiles:async function(e){const t=[],i=this.controller.uploader.uploader.uploader;e.forEach(e=>{/^image\//.test(e.type)?t.push(e):i.addFile(o.rml.file(e))}),t.length&&(await(0,n.default)(t)).forEach(e=>i.addFile(o.rml.file(e)))}})},{compat:2,converter:3,"image-dialog":5}],2:[function(e,t,i){"use strict";var a=new class{get svg(){return _wpPluploadSettings.defaults.filters.mime_types[0].extensions.split(",").includes("svg")}get webp(){return 0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}};t.exports={rml:{file:e=>(e.getSource||(e.getSource=()=>e),e)},supports:a}},{}],3:[function(e,t,i){"use strict";var o=e("compat"),a=e("filename");const s={clipboardItemsToFiles:a=>{const n=[];return new Promise((e,t)=>{var i=Array.from(a).map(e=>{var t;if("string"===e.kind)return(null!=(t={"text/plain":async e=>{if(o.supports.svg){e=await s.itemToString(e);if(0<=e.toLowerCase().indexOf("<svg"))if((new DOMParser).parseFromString(e,"image/svg+xml").querySelector("svg"))return[s.stringToFile(e,"image/svg+xml")]}return[]},"text/html":async e=>{const t=new URL(document.location);var i=document.createElement("div");i.innerHTML=await s.itemToString(e);const a=Array.from(i.querySelectorAll("img")).filter(e=>{e=new URL(e.src);return!["http:","https:"].includes(e.protocol)||t.hostname!==e.hostname}).map(e=>s.elementToFile(e));return new Promise((t,e)=>{Promise.allSettled(a).then(e=>t(Array.from(e).map(e=>e.value)))})}}[t=e.type])?t:()=>new Promise((e,t)=>e([])))(e).then(e=>{n.push(...e.filter(e=>0<e.size))}).catch(e=>console.error(e))});Promise.allSettled(i).then(()=>e(n))})},clipboardItemsToHtml:async e=>{let t,i;for(t=0;t<e.length;t++)if("string"===(i=e[t]).kind&&"text/html"===i.type)return s.itemToString(i);return""},gdocsItemToSources:async i=>new Promise((t,e)=>{i.getAsString(async e=>{e=Object.values(JSON.parse(JSON.parse(e).data).image_urls);t(e)})}),gdocsItemToFiles:async e=>{let t;var i=await s.gdocsItemToSources(e),a=[];for(t=0;t<i.length;t++)a.push(await s.blobUrlToFile(i[t]));return a},itemToString:async i=>new Promise((t,e)=>{i.getAsString(e=>t(e))}),elementToFile:async e=>{return await s.urlToFile(e.src,e.alt)},urlToFile:async function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";let i;var a=e.substr(0,e.indexOf(":"));return"data"===a?i=s.dataUrlToFile(e,t):["blob","http","https"].includes(a)&&(i=await s.blobUrlToFile(e,t)),i},urlToMime:async e=>{var t=e.substr(0,e.indexOf(":"));let i;return"data"===t?i=s.dataUrlToMime(e):["blob","http","https"].includes(t)&&(i=await s.blobUrlToMime(e)),i},urlToType:async e=>{e=await s.urlToMime(e);return e.substr(0,e.indexOf("/"))},urlToBlobUrl:async e=>{e=await s.blobUrlToFile(e);return s.fileToBlobUrl(e)},stringToFile:(e,t)=>s.blobToFile(new Blob([e],{type:t})),blobToFile:function(e){return new File([e],(0,a.safeFilename)(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:""),{type:e.type})},blobUrlToMime:async e=>{return(await s.blobUrlToBlob(e)).type},blobUrlToType:async e=>{e=await s.blobUrlToBlob(e);return e.type.substr(0,e.type.indexOf("/"))},blobUrlToBlob:async function(e){return await fetch(e).then(e=>e.blob())},blobUrlToFile:async function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",e=await s.blobUrlToBlob(e);return s.blobToFile(e,t)},blobUrlToDataUrl:async e=>{e=await fetch(e).then(e=>e.blob());return await s.fileToDataUrl(e)},dataUrlToMime:e=>e.match("data:([^;]+);")[1],dataUrlToType:e=>e.match("data:([^/]+)/")[1],dataUrlToBlob:e=>{let t=e.split(","),i=t[0].match(/:(.*?);/)[1],a=atob(t[1]),n=a.length,o=new Uint8Array(n);for(;n--;)o[n]=a.charCodeAt(n);return new Blob([o],{type:i})},dataUrlToFile:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return s.blobToFile(s.dataUrlToBlob(e),t)},dataUrlToBlobUrl:e=>s.fileToBlobUrl(s.dataUrlToBlob(e)),fileToBlobUrl:e=>URL.createObjectURL(e),fileToDataUrl:a=>new Promise((e,t)=>{const i=new FileReader;i.addEventListener("load",()=>e(i.result)),i.readAsDataURL(a)})};t.exports=s},{compat:2,filename:4}],4:[function(e,t,i){"use strict";var a=(e=e("mime"))&&e.__esModule?e:{default:e};const n=e=>{function t(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2;return("00"+e.toString()).substr(-t)}var i;let a=thepaste.options.default_filename;const n=new Date,o=(null==(i=document.querySelector('#post [name="post_title"]#title'))?void 0:i.value)||(null==(i=document.querySelector(".wp-block-post-title"))?void 0:i.textContent)||(null==(i=document.querySelector("h1"))?void 0:i.textContent),s=thepaste.options.filename_values,r=[{s:"%Y",r:n.getFullYear()},{s:"%y",r:n.getFullYear()%100},{s:"%m",r:t(n.getMonth()+1)},{s:"%d",r:t(n.getDate())},{s:"%e",r:n.getDate()},{s:"%H",r:t(n.getHours())},{s:"%I",r:t(n.getHours()%12)},{s:"%M",r:t(n.getMinutes())},{s:"%S",r:t(n.getSeconds())},{s:"%s",r:Math.floor(n.getTime()/1e3)},{s:"%x",r:n.toLocaleDateString()},{s:"%X",r:n.toLocaleTimeString()}];return void 0!==o?r.push({s:"<postname>",r:o}):r.push({s:"<postname>",r:""}),Object.keys(s).forEach(e=>{s[e]?r.push({s:"<".concat(e,">"),r:s[e]}):r.push({s:"<".concat(e,">"),r:""})}),r.forEach(function(e){a=a.replace(e.s,e.r)}),"string"==typeof e&&(a+="."+e),a};t.exports={generateFilename:n,safeFilename:function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";e=e.type,e=a.default.extension(e);return e!==(t=(t=t.replace(/[^\p{L}\p{M}\p{S}\p{N}\p{P}\p{Zs}]/gu,"-").trim())||n(e)).split(".").pop()&&(t+=".".concat(e)),t}}},{mime:7}],5:[function(i,a,e){!function(t){!function(){"use strict";var n=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),o=e(i("image-list"));function e(e){return e&&e.__esModule?e:{default:e}}let s=null,r=null;a.exports=a=>new Promise((t,e)=>{if(null!==s)r.addFiles(a),t([]);else{s=new wp.media.view.Modal({events:{keydown:function(e){"Enter"===e.key?r.submit():"Escape"===e.key&&s.close()},"click .media-modal-close":function(e){s.close()}},controller:{trigger:()=>{}},title:thepaste.l10n.the_paste}),r=new o.default({controller:s});const i=(0,n.default)("body").is(".modal-open");r.on("thepaste:submit",async()=>{var e=await r.getFiles();s.close(),t(e)}),r.on("thepaste:cancel",()=>{s.close(),t([])}),s.content(r),r.addFiles(a),s.open(),s.on("close",()=>{(0,n.default)("body").toggleClass("the-paste-modal-open",!1),(0,n.default)("body").toggleClass("modal-open",i),setTimeout(()=>{s.remove(),s=null},10)}),(0,n.default)("body").toggleClass("the-paste-modal-open",!0)}})}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"image-list":6}],6:[function(e,t,i){"use strict";var o=n(e("converter")),s=n(e("mime")),a=e("compat"),r=e("filename");function n(e){return e&&e.__esModule?e:{default:e}}const l=wp.media.View.extend({tagName:"form",template:wp.template("the-paste-image-list-item"),className:"the-paste-image-list-item",events:{'click [name="discard"]':"discard",'change [name="the-paste-format"]':"updateView"},initialize:function(e){let a=e["file"];wp.media.View.prototype.initialize.apply(this,arguments),this.file=a,new Promise((e,t)=>{const i=new Image;i.addEventListener("load",function(){e(i)}),i.src=o.default.fileToBlobUrl(a)}).then(e=>{var t=e.width&&e.height;this.canvas=this.$("canvas").get(0),"image/svg+xml"===this.file.type&&(t?document.body.append(e):this.canvas.after(e)),this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.getContext("2d").drawImage(e,0,0),"image/svg+xml"===this.file.type&&(t?e:this.$('[data-format]:not([data-format="image/svg+xml"])')).remove()})},updateView:function(){var e=this.$('[name="the-paste-format"]:checked').val();e!==this.file.type&&["image/webp","image/jpeg"].includes(e)?this.$(".the-paste-quality").show():this.$(".the-paste-quality").hide()},render:function(){wp.media.View.prototype.render.apply(this,arguments);var e=this.file.type,t=this.file.name.replace(/\.([^\.]*)$/,"");a.supports.webp||"image/webp"!==e&&this.$('[data-format="image/webp"]').remove(),this.$('[name="the-paste-format"][value="'.concat(e,'"]')).prop("checked",!0),this.$('[name="the-paste-filename"]').val(t),this.$('[name="the-paste-filename"]').prop("placeholder",(0,r.generateFilename)()),a.supports.svg&&"image/svg+xml"===e||(this.$('[data-format="image/svg+xml"]').remove(),"image/svg+xml"===e&&this.$('[name="the-paste-format"][value="image/png"]').prop("checked",!0)),this.updateView()},getFile:function(){const i=this.$('[name="the-paste-format"]:checked').val();var e=this.$('[name="the-paste-filename"]').val()||(0,r.generateFilename)();const a="".concat(e,".").concat(s.default.extension(i)),n=parseFloat(this.$('[name="the-paste-quality"]').val())||thepaste.options.jpeg_quality;return this.file.type===i?new Promise((e,t)=>{e(new File([this.file],a,{type:i}))}):new Promise((t,e)=>{this.canvas.toBlob(e=>{t(o.default.blobToFile(e,a))},i,.01*n)})},discard:function(){this.controller.discardItem(this)}});e=wp.media.View.extend({template:wp.template("the-paste-image-list"),className:"the-paste-image-list",events:{"click .media-frame-toolbar button":"submit"},initialize:function(){wp.media.View.prototype.initialize.apply(this,arguments),this.files=[],this.items=[],this.button=new wp.media.view.Button({className:"button-primary button-hero"}),this.render()},discardItem:function(t){this.files=this.files.filter(e=>e!==t.file),this.items=this.items.filter(e=>e!==t),t.$el.remove(),this.items.length||this.trigger("thepaste:cancel")},addFiles:function(e){this.files.push(...e),e.forEach(e=>{e=new l({file:e,controller:this});e.render(),this.$(".content").append(e.$el),this.items.push(e),e.render()})},getFiles:async function(){var e=[];for(const t of this.items)e.push(await t.getFile());return e},submit:function(){this.trigger("thepaste:submit")}});t.exports=e},{compat:2,converter:3,filename:4,mime:7}],7:[function(e,t,i){"use strict";const a=Object.keys(thepaste.options.mime_types),n=Object.values(thepaste.options.mime_types);a.push("zip"),n.push("application/x-zip-compressed"),t.exports={extension:e=>{e=n.indexOf(e);return-1!==e&&a[e]},type:e=>{e=a.indexOf(e);return-1!==e&&n[e]}}},{}]},{},[1]);
//# sourceMappingURL=the-paste.js.map
